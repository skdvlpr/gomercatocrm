# GomercatoCRM ‚Äî Sales Modules: –ü–æ–ª–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –∏ –ø–ª–∞–Ω –∏–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏–∏

> **–°–æ–∑–¥–∞–Ω–æ**: 26 —Ñ–µ–≤—Ä–∞–ª—è 2026  
> **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç –¥–ª—è AI-–∞–≥–µ–Ω—Ç–æ–≤ (Google Gemini, Copilot –∏ –¥—Ä.)  
> **–°—Ç–∞—Ç—É—Å –ø—Ä–æ–µ–∫—Ç–∞**: –í –∞–∫—Ç–∏–≤–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ  
> **–ë–∞–∑–∞**: EspoCRM 9.3.0 + DDEV (Docker –ª–æ–∫–∞–ª—å–Ω–æ)  
> **–†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π**: [github.com/skdvlpr/gomercatocrm](https://github.com/skdvlpr/gomercatocrm)

---

## üìñ –ß–¢–û –¢–ê–ö–û–ï GOMERCATOCRM

GomercatoCRM ‚Äî —ç—Ç–æ –∫–∞—Å—Ç–æ–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è [EspoCRM](https://www.espocrm.com/) (open-source CRM –Ω–∞ PHP + JavaScript), –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ø–æ–¥ –±–∏–∑–Ω–µ—Å **GoMercato.it** ‚Äî –∏—Ç–∞–ª—å—è–Ω—Å–∫–æ–π –∫–æ–º–ø–∞–Ω–∏–∏ –∏–∑ –¢—É—Ä–∏–Ω–∞ (–ü—å–µ–º–æ–Ω—Ç), –∑–∞–Ω–∏–º–∞—é—â–µ–π—Å—è –ø—Ä–æ–¥–∞–∂–µ–π –∫–æ–º–ø–ª–µ–∫—Å–Ω—ã—Ö digital-—Ä–µ—à–µ–Ω–∏–π –¥–ª—è —É–≤–µ–ª–∏—á–µ–Ω–∏—è –ø—Ä–æ–¥–∞–∂: CRM, AI-–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã, –º–∞—Ä–∫–µ—Ç–∏–Ω–≥–æ–≤—ã–µ –∫–∞–Ω–∞–ª—ã.

### –ë–∏–∑–Ω–µ—Å-–∫–æ–Ω—Ç–µ–∫—Å—Ç
- **–ö–ª–∏–µ–Ω—Ç**: GoMercato.it, Torino, Piemonte, Italia
- **–ú–æ–¥–µ–ª—å**: B2B + B2C –ø—Ä–æ–¥–∞–∂–∏ —Å–ª–æ–∂–Ω—ã—Ö digital-—Å–µ—Ä–≤–∏—Å–æ–≤
- **–Ø–∑—ã–∫ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ CRM**: Italiano (it_IT) ‚Äî –æ—Å–Ω–æ–≤–Ω–æ–π, English ‚Äî fallback
- **–û–∫—Ä—É–∂–µ–Ω–∏–µ**: DDEV (local dev), EspoCRM 9.3.0
- **–ò–í–ê**: –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –ò—Ç–∞–ª–∏—è 22%, San Marino 17%

---

## ‚úÖ –ß–¢–û –£–ñ–ï –°–î–ï–õ–ê–ù–û (–ò–°–¢–û–†–ò–Ø –ü–†–û–ï–ö–¢–ê)

### 1. WhatsApp Integration ‚Äî –ü–û–õ–ù–û–°–¢–¨–Æ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û ‚úÖ

–ü–æ–ª–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è WhatsApp Business –≤ EspoCRM —á–µ—Ä–µ–∑ WAHA API (Docker). –ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: [`impls/whatsapp_architecture.md`](./whatsapp_architecture.md)

#### –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ:
- **Frontend –≤–∏–¥–∂–µ—Ç** (`client/custom/src/whatsapp-widget-init.js`) ‚Äî ~1450 —Å—Ç—Ä–æ–∫ Vanilla JS
  - 4 —ç–∫—Ä–∞–Ω–∞: login (QR), chatList, chat, contacts
  - HTTP Polling –∫–∞–∂–¥—É—é 1 —Å–µ–∫—É–Ω–¥—É –∫–∞–∫ –æ—Å–Ω–æ–≤–Ω–æ–π –º–µ—Ö–∞–Ω–∏–∑–º
  - WebSocket WAMP (AutobahnJS) –∫–∞–∫ real-time push
  - Optimistic rendering –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Å–æ–æ–±—â–µ–Ω–∏–π
- **Backend Controller** (`custom/Espo/Custom/Controllers/WhatsApp.php`)
  - 10 endpoints: login, qrCode, status, getChats, getChatMessages, getContacts, sendMessage, webhook, saveSettings, logout
  - –ì–∏–±—Ä–∏–¥–Ω—ã–π getChatMessages: WAHA API + –ª–æ–∫–∞–ª—å–Ω–∞—è –ë–î
- **WAHA Client** (`custom/Espo/Custom/Core/WhatsApp/WhatsAppClient.php`)
  - HTTP-–∫–ª–∏–µ–Ω—Ç –∫ WAHA Docker-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—É –Ω–∞ `whatsapp-api:3000`
- **WebSocket Service** (`custom/Espo/Modules/WhatsApp/Services/WebSocketService.php`)
  - Broadcast —á–µ—Ä–µ–∑ EspoCRM `Submission`
- **Entity WhatsAppMessage** ‚Äî —Ç–∞–±–ª–∏—Ü–∞ `whats_app_message` –≤ MySQL
  - UNIQUE constraint –Ω–∞ `messageId` –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç –¥—É–±–ª–∏–∫–∞—Ç–æ–≤
- **Webhook** (noAuth) ‚Äî –ø—Ä–∏—ë–º –≤—Ö–æ–¥—è—â–∏—Ö –æ—Ç WAHA
- **Nginx WebSocket proxy** (`.ddev/nginx/websocket.conf`) ‚Äî WSS 8443 ‚Üí WS 8080
- **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –ø—Ä–æ–±–ª–µ–º—ã**: 502 Bad Gateway, auth token mismatch, topic mismatch, Sender‚ÜíSubmission

#### –ö–ª—é—á–µ–≤—ã–µ —Ñ–∞–π–ª—ã WhatsApp:
```
custom/Espo/Custom/
‚îú‚îÄ‚îÄ Controllers/WhatsApp.php
‚îú‚îÄ‚îÄ Core/WhatsApp/WhatsAppClient.php
‚îú‚îÄ‚îÄ Resources/
‚îÇ   ‚îú‚îÄ‚îÄ metadata/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ entityDefs/WhatsAppMessage.json
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ app/client.json             ‚Üê –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ JS –≤–∏–¥–∂–µ—Ç–∞
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ app/webSocket.json          ‚Üê —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è WS —Ç–æ–ø–∏–∫–∞
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ routes.json
‚îÇ   ‚îî‚îÄ‚îÄ i18n/it_IT/WhatsAppMessage.json
custom/Espo/Modules/WhatsApp/
‚îî‚îÄ‚îÄ Services/WebSocketService.php
client/custom/
‚îú‚îÄ‚îÄ src/whatsapp-widget-init.js
‚îî‚îÄ‚îÄ css/whatsapp-widget.css
.ddev/nginx/websocket.conf              ‚Üê WSS proxy
```

---

## üî® –ß–¢–û –ù–£–ñ–ù–û –°–î–ï–õ–ê–¢–¨ ‚Äî SALES MODULE

### –¶–µ–ª—å
–°–æ–∑–¥–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–π –º–æ–¥—É–ª—å `Sales` –≤–Ω—É—Ç—Ä–∏ EspoCRM —Å 4 –Ω–æ–≤—ã–º–∏ —Å—É—â–Ω–æ—Å—Ç—è–º–∏ –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ —Ü–∏–∫–ª–∞ –ø—Ä–æ–¥–∞–∂: –æ—Ç –∫–∞—Ç–∞–ª–æ–≥–∞ —Ç–æ–≤–∞—Ä–æ–≤ –¥–æ –ø–æ–¥–ø–∏—Å–∞–Ω–Ω–æ–≥–æ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞.

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–≤—è–∑–µ–π (ERD)

```
Opportunit√† (1) ‚îÄ‚îÄ‚îÄ‚îÄ (N) Proposta commerciale (Quote)
     ‚îÇ                          ‚îÇ
     ‚îÇ                          ‚îî‚îÄ‚îÄ (N) Lista prodotti (ProductList)
     ‚îÇ                                        ‚îÇ
     ‚îÇ                                        ‚îî‚îÄ‚îÄ (N) ProductListItem ‚îÄ‚îÄ‚îÄ‚îÄ (1) Prodotto
     ‚îÇ
     ‚îî‚îÄ‚îÄ (1) Contratto  ‚Üê‚îÄ‚îÄ‚îÄ‚îÄ [AUTO-CREATED when Opportunity = Closed Won]
                  ‚îÇ
                  ‚îî‚îÄ‚îÄ (ref.) Proposta accettata (Quote vincente ‚Äî opzionale)
```

**–ö–ª—é—á–µ–≤–∞—è –ª–æ–≥–∏–∫–∞**:
- `Contract` —Å–æ–∑–¥–∞—ë—Ç—Å—è **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏** –∏–∑ `Opportunity` –ø—Ä–∏ `stage = Closed Won` (–ù–ï –∏–∑ Quote)
- `Quote` –≤—Å–µ–≥–¥–∞ –ø—Ä–∏–≤—è–∑–∞–Ω–∞ –∫ `Opportunity` (standalone —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø—Ä–µ—â–µ–Ω–æ)
- `ProductList` –Ω–µ–ª—å–∑—è —Å–æ–∑–¥–∞—Ç—å –∏–∑ UI –Ω–∞–ø—Ä—è–º—É—é (—Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ Quote)
- –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ Quote ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—ë—Ç—Å—è –ø–µ—Ä–≤–∞—è ProductList `Gruppo 1`

### –†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ –º–æ–¥—É–ª—è

```
custom/Espo/Modules/Sales/         ‚Üê –æ—Ç–¥–µ–ª—å–Ω—ã–π –º–æ–¥—É–ª—å (–ù–ï –≤ Custom/)
‚îú‚îÄ‚îÄ Module.php
‚îú‚îÄ‚îÄ Entities/
‚îÇ   ‚îú‚îÄ‚îÄ Product.php
‚îÇ   ‚îú‚îÄ‚îÄ Quote.php
‚îÇ   ‚îú‚îÄ‚îÄ ProductList.php
‚îÇ   ‚îú‚îÄ‚îÄ ProductListItem.php
‚îÇ   ‚îî‚îÄ‚îÄ Contract.php
‚îú‚îÄ‚îÄ Resources/
‚îÇ   ‚îú‚îÄ‚îÄ metadata/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ entityDefs/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ scopes/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ clientDefs/
‚îÇ   ‚îú‚îÄ‚îÄ i18n/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ it_IT/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ en_US/
‚îÇ   ‚îî‚îÄ‚îÄ layouts/
‚îú‚îÄ‚îÄ Hooks/
‚îÇ   ‚îú‚îÄ‚îÄ Quote/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ CreateDefaultProductList.php
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ GenerateNumber.php
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ValidateAmount.php
‚îÇ   ‚îî‚îÄ‚îÄ Opportunity/
‚îÇ       ‚îî‚îÄ‚îÄ CreateContract.php
‚îú‚îÄ‚îÄ Controllers/
‚îÇ   ‚îî‚îÄ‚îÄ ProductList.php
‚îî‚îÄ‚îÄ Services/
    ‚îú‚îÄ‚îÄ QuotePdfService.php
    ‚îî‚îÄ‚îÄ ContractNumberGenerator.php
```

---

## üìã –î–ï–¢–ê–õ–¨–ù–´–ï –û–ü–ò–°–ê–ù–ò–Ø –°–£–©–ù–û–°–¢–ï–ô

### 1. Product ‚Äî Prodotto (`products` –≤ –ë–î)

**–í–∏–¥–∏–º–æ—Å—Ç—å –≤ UI**: ‚úÖ –î–æ—Å—Ç—É–ø–Ω–∞ —á–µ—Ä–µ–∑ –º–µ–Ω—é ¬´Prodotti¬ª  
**–°–æ–∑–¥–∞–Ω–∏–µ –∏–∑ UI**: ‚úÖ –î–∞, –∫–∞–∫ –æ–±—ã—á–Ω–∞—è —Å—É—â–Ω–æ—Å—Ç—å (Accounts, Leads –∏ —Ç.–¥.)

#### –ü–æ–ª—è:

| –ü–æ–ª–µ | –¢–∏–ø | –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|:---:|----------|
| `name` | varchar(249) | ‚úÖ | –ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞/—É—Å–ª—É–≥–∏ |
| `status` | enum | ‚úÖ | Active/Inactive ‚Üí Attivo/Inattivo |
| `type` | enum | ‚úÖ | Product/Service ‚Üí Prodotto/Servizio |
| `price` | currency (EUR) | ‚úÖ | –ë–∞–∑–æ–≤–∞—è —Ü–µ–Ω–∞ |
| `sku` | varchar(100), UNIQUE | ‚úÖ | –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∫–æ–¥ –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞/–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π |
| `description` | text | ‚Äî | –ü–æ–ª–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ (–≤—ã–≤–æ–¥–∏—Ç—Å—è –≤ PDF) |
| `stockQuantity` | float, min:0 | ‚Äî | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–∞ —Å–∫–ª–∞–¥–µ |
| `infiniteStock` | bool | ‚Äî | –ë–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π –∑–∞–ø–∞—Å (–∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç stockQuantity) |
| `minPrice` | currency | ‚Äî | –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞ (floor price), –Ω–µ–ª—å–∑—è –¥–µ–ª–∞—Ç—å —Å–∫–∏–¥–∫—É –Ω–∏–∂–µ |
| `vatRate` | enum | ‚Äî | Aliquota IVA: 0% / 4% / 10% / 17%(San Marino) / 22%(Italia), default 22% |
| `referenceCountry` | enum | ‚Äî | Italia / San Marino / Estero ‚Äî –¥–ª—è –∞–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è IVA |
| `category` | enum | ‚Äî | Hardware / Software / Servizi / Manutenzione / Licenze |
| `unitOfMeasure` | enum | ‚Äî | pz / ora / kg / mese / anno / licenza |
| `image` | file/image | ‚Äî | –ü—Ä–µ–≤—å—é –≤ PDF |
| `internalNotes` | text | ‚Äî | –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –∑–∞–º–µ—Ç–∫–∏ (–Ω–µ –≤ PDF) |

---

### 2. Quote ‚Äî Proposta commerciale (`quotes` –≤ –ë–î)

**–í–∏–¥–∏–º–æ—Å—Ç—å –≤ UI**: ‚úÖ –î–æ—Å—Ç—É–ø–Ω–∞ —á–µ—Ä–µ–∑ –º–µ–Ω—é ¬´Proposte commerciali¬ª  
**–°–æ–∑–¥–∞–Ω–∏–µ –∏–∑ UI**: ‚úÖ –î–∞, –Ω–æ **—Ç–æ–ª—å–∫–æ –∏–∑ Opportunity** (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è —Å–≤—è–∑—å)  
**PDF**: ‚úÖ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è PDF —Å –ª–æ–≥–æ—Ç–∏–ø–æ–º –∫–æ–º–ø–∞–Ω–∏–∏, –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –∏ —Ç–∞–±–ª–∏—Ü–µ–π –ø—Ä–æ–¥—É–∫—Ç–æ–≤

#### –ü–æ–ª—è:

| –ü–æ–ª–µ | –¢–∏–ø | –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|:---:|----------|
| `name` | varchar(249) | ‚úÖ | –ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è |
| `number` | varchar(50), readOnly | ‚Äî | –ê–≤—Ç–æ: `PROP-{ANNO}-{SEQ}` (es. `PROP-2026-00001`) |
| `status` | enum | ‚úÖ | Draft/Sent/Accepted/Rejected ‚Üí Bozza/Inviata/Accettata/Rifiutata |
| `opportunity` | belongsTo Opportunity | ‚úÖ | –†–æ–¥–∏—Ç–µ–ª—å—Å–∫–∞—è Opportunit√† |
| `account` | belongsTo Account | ‚Äî | –ö–ª–∏–µ–Ω—Ç (–Ω–∞—Å–ª–µ–¥—É–µ—Ç—Å—è –∏–∑ Opportunity) |
| `contact` | belongsTo Contact | ‚Äî | –ö–æ–Ω—Ç–∞–∫—Ç–Ω–æ–µ –ª–∏—Ü–æ –∫–ª–∏–µ–Ω—Ç–∞ |
| `validUntil` | date | ‚Äî | –°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è |
| `globalDiscount` | float(0-100) | ‚Äî | –°–∫–∏–¥–∫–∞ –Ω–∞ –≤—Å—ë –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ (%) |
| `taxableAmount` | currency, readOnly | ‚Äî | Imponibile (–±–µ–∑ IVA) |
| `totalVat` | currency, readOnly | ‚Äî | –°—É–º–º–∞ IVA |
| `totalAmount` | currency, readOnly | ‚Äî | Totale con IVA (—Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏) |
| `language` | enum | ‚Äî | Italiano / English (–¥–ª—è –º—É–ª—å—Ç–∏—è–∑—ã—á–Ω–æ–≥–æ PDF) |
| `notesForClient` | text | ‚Äî | –ó–∞–º–µ—Ç–∫–∏ –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞ (–≤–∏–¥–Ω—ã –≤ PDF) |
| `internalNotes` | text | ‚Äî | –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –∑–∞–º–µ—Ç–∫–∏ (–Ω–µ –≤ PDF) |
| `productLists` | hasMany ProductList | ‚Äî | –ì—Ä—É–ø–ø—ã —Ç–æ–≤–∞—Ä–æ–≤ |

#### –ë–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–∞:
- –ï—Å–ª–∏ `totalAmount > Opportunity.amount` ‚Üí –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏
- –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ Quote ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—ë—Ç—Å—è ProductList ¬´Gruppo 1¬ª
- –ù—É–º–µ—Ä–∞—Ü–∏—è –∞–≤—Ç–æ: `PROP-{ANNO}-{SEQ:05d}`

---

### 3. ProductList ‚Äî Lista prodotti (`product_lists` –≤ –ë–î)

**–í–∏–¥–∏–º–æ—Å—Ç—å –≤ UI**: ‚ùå –ù–ï –ø–æ—è–≤–ª—è–µ—Ç—Å—è –≤ –º–µ–Ω—é –Ω–∞–≤–∏–≥–∞—Ü–∏–∏  
**–°–æ–∑–¥–∞–Ω–∏–µ –∏–∑ UI –Ω–∞–ø—Ä—è–º—É—é**: ‚ùå –ó–ê–ü–†–ï–©–ï–ù–û ‚Äî —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ Quote  
**–î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –¥–ª—è Formula/Formula Sandbox**: ‚úÖ –î–∞

#### –ü–æ–ª—è:

| –ü–æ–ª–µ | –¢–∏–ø | –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|:---:|----------|
| `name` | varchar(100) | ‚úÖ | Default: `Gruppo 1`, `Gruppo 2`, ... |
| `quote` | belongsTo Quote | ‚úÖ | –†–æ–¥–∏—Ç–µ–ª—å—Å–∫–∞—è Quote |
| `order` | int | ‚Äî | –ü–æ—Ä—è–¥–æ–∫ –≥—Ä—É–ø–ø—ã –≤ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–∏ (–¥–ª—è drag&drop) |
| `subtotal` | currency, readOnly | ‚Äî | –°—É–º–º–∞ —Å—Ç—Ä–æ–∫ –≥—Ä—É–ø–ø—ã (–∞–≤—Ç–æ) |
| `groupDescription` | text | ‚Äî | –¢–µ–∫—Å—Ç –Ω–∞–¥ —Å–ø–∏—Å–∫–æ–º –≥—Ä—É–ø–ø—ã –≤ PDF |
| `items` | hasMany ProductListItem | ‚Äî | –°—Ç—Ä–æ–∫–∏ —Å —Ç–æ–≤–∞—Ä–∞–º–∏ |

#### –î–æ—á–µ—Ä–Ω—è—è —Å—É—â–Ω–æ—Å—Ç—å: ProductListItem (`product_list_items` –≤ –ë–î)

| –ü–æ–ª–µ | –¢–∏–ø | –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|:---:|----------|
| `product` | belongsTo Product | ‚úÖ | –°—Å—ã–ª–∫–∞ –Ω–∞ –ø—Ä–æ–¥—É–∫—Ç |
| `quantity` | float, default:1 | ‚úÖ | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ |
| `unitPrice` | currency | ‚úÖ | –¶–µ–Ω–∞ –∑–∞ –µ–¥–∏–Ω–∏—Ü—É (–ø—Ä–µ–¥–∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –∏–∑ Product, –∏–∑–º–µ–Ω—è–µ–º–æ) |
| `discount` | float(0-100), default:0 | ‚Äî | –°–∫–∏–¥–∫–∞ (%) |
| `totalWithoutDiscount` | currency, readOnly | ‚Äî | qty √ó unitPrice |
| `lineTotal` | currency, readOnly | ‚Äî | qty √ó unitPrice √ó (1 - discount/100) |
| `vatRate` | float | ‚Äî | IVA (%) ‚Äî –Ω–∞—Å–ª–µ–¥—É–µ—Ç—Å—è –∏–∑ Product, –∏–∑–º–µ–Ω—è–µ–º–æ |
| `lineDescription` | text | ‚Äî | –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π —Ç–µ–∫—Å—Ç —Å—Ç—Ä–æ–∫–∏ –≤ PDF |

---

### 4. Contract ‚Äî Contratto (`contracts` –≤ –ë–î)

**–í–∏–¥–∏–º–æ—Å—Ç—å –≤ UI**: ‚úÖ –î–æ—Å—Ç—É–ø–Ω–∞ —á–µ—Ä–µ–∑ –º–µ–Ω—é ¬´Contratti¬ª  
**–°–æ–∑–¥–∞–Ω–∏–µ**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ `Opportunity.stage = Closed Won` (—á–µ—Ä–µ–∑ Hook), –ø–ª—é—Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Ä—É—á–Ω–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è  
**PDF**: ‚úÖ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ + foreach –ø–æ ProductList

#### –ü–æ–ª—è:

| –ü–æ–ª–µ | –¢–∏–ø | –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|-----|:---:|----------|
| `name` | varchar(249) | ‚úÖ | –ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞ |
| `number` | varchar(50), UNIQUE, readOnly | ‚Äî | –ê–≤—Ç–æ: `CON-{ANNO}-{SEQ}` (es. `CON-2026-00001`) |
| `status` | enum | ‚úÖ | Active/Expired/Cancelled/Renewed ‚Üí Attivo/Scaduto/Disdetto/Rinnovato |
| `opportunity` | belongsTo Opportunity | ‚úÖ | –†–æ–¥–∏—Ç–µ–ª—å—Å–∫–∞—è Opportunit√† |
| `account` | belongsTo Account | ‚úÖ | –ö–ª–∏–µ–Ω—Ç (–Ω–∞—Å–ª–µ–¥—É–µ—Ç—Å—è –∏–∑ Opportunity) |
| `winningQuote` | belongsTo Quote | ‚Äî | –ü—Ä–∏–Ω—è—Ç–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) |
| `contact` | belongsTo Contact | ‚Äî | –ö–æ–Ω—Ç–∞–∫—Ç–Ω–æ–µ –ª–∏—Ü–æ (–ø–æ–¥–ø–∏—Å–∞–Ω—Ç) |
| `signed` | bool | ‚Äî | Firmato |
| `renewed` | bool | ‚Äî | Rinnovato |
| `value` | currency | ‚úÖ | –°—Ç–æ–∏–º–æ—Å—Ç—å –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞ (EUR) |
| `signDate` | date | ‚Äî | Data firma |
| `startDate` | date | ‚Äî | –î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞ –¥–µ–π—Å—Ç–≤–∏—è |
| `expirationDate` | date | ‚Äî | Data scadenza |
| `cancellationDate` | date | ‚Äî | Data disdetta |
| `durationMonths` | int, readOnly | ‚Äî | –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è: startDate ‚Üí expirationDate |
| `autoRenewal` | bool | ‚Äî | –ê–≤—Ç–æ–ø—Ä–æ–¥–ª–µ–Ω–∏–µ |
| `renewalNoticeDays` | int, default:30 | ‚Äî | –î–Ω–µ–π –¥–æ –¥–µ–¥–ª–∞–π–Ω–∞ –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è |
| `terms` | text | ‚Äî | Termini e condizioni |
| `internalNotes` | text | ‚Äî | –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –∑–∞–º–µ—Ç–∫–∏ |
| `assignedUser` | people | ‚Äî | –û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π (–ø–æ—Å—Ç–ø—Ä–æ–¥–∞–∂–∞) |

#### –ë–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–∞:
- –°–æ–∑–¥–∞—ë—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ `Opportunity.stage ‚Üí Closed Won`
- –ü—Ä–æ–≤–µ—Ä–∫–∞: –µ—Å–ª–∏ –∫–æ–Ω—Ç—Ä–∞–∫—Ç —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –¥–ª—è —ç—Ç–æ–π Opportunity ‚Üí –Ω–µ —Å–æ–∑–¥–∞–≤–∞—Ç—å –≤—Ç–æ—Ä–æ–π
- –ê–≤—Ç–æ-–Ω—É–º–µ—Ä–∞—Ü–∏—è: `CON-{ANNO}-{SEQ:05d}`
- –ê–≤—Ç–æ-–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ: `name`, `amount‚Üívalue`, `accountId` –∏–∑ Opportunity
- –ê–≤—Ç–æ-–ø–æ–∏—Å–∫: Quote —Å `status=Accepted` ‚Üí –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ `winningQuote`

---

## üèóÔ∏è –ü–û–®–ê–ì–û–í–´–ô –ü–õ–ê–ù –ò–ú–ü–õ–ï–ú–ï–ù–¢–ê–¶–ò–ò

### –ü–†–ê–í–ò–õ–û ‚Ññ1 ‚Äî –ù–ò–ö–û–ì–î–ê –ù–ï –¢–†–û–ì–ê–¢–¨ `application/`

> ‚õî –ü–∞–ø–∫–∞ `application/` ‚Äî —ç—Ç–æ —è–¥—Ä–æ EspoCRM. –ö–ê–¢–ï–ì–û–†–ò–ß–ï–°–ö–ò –ó–ê–ü–†–ï–©–ï–ù–û –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å —Ñ–∞–π–ª—ã –≤ –Ω–µ–π.
> ‚úÖ –í—Å–µ –∫–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏–∏ –¢–û–õ–¨–ö–û –≤ `custom/`.

### –ü–†–ê–í–ò–õ–û ‚Ññ2 ‚Äî –ü–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è metadata:
```bash
ddev exec php clear_cache.php && ddev exec php rebuild.php
```

### –ü–†–ê–í–ò–õ–û ‚Ññ3 ‚Äî Naming conventions
- –°—É—â–Ω–æ—Å—Ç–∏: `PascalCase` (`ProductList`)
- –ü–æ–ª—è: `camelCase` (`totalAmount`)
- –¢–∞–±–ª–∏—Ü—ã –ë–î: `snake_case` (`product_list`)
- –ú–æ–¥—É–ª—å `Sales`: namespace `Espo\Modules\Sales`

---

### –§–ê–ó–ê 0 ‚Äî –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è

#### 0.1 –ò–∑—É—á–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é
- [docs.espocrm.com/development/metadata](https://docs.espocrm.com/development/metadata/)
- [docs.espocrm.com/development/hooks](https://docs.espocrm.com/development/hooks/)
- [docs.espocrm.com/user-guide/pdf-templates](https://docs.espocrm.com/user-guide/pdf-templates/)

#### 0.2 –ü–æ–Ω—è—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É
```
custom/
‚îú‚îÄ‚îÄ Espo/Custom/                  ‚Üê —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç (WhatsApp, etc.)
‚îÇ   ‚îú‚îÄ‚îÄ Controllers/WhatsApp.php
‚îÇ   ‚îú‚îÄ‚îÄ Core/WhatsApp/
‚îÇ   ‚îî‚îÄ‚îÄ Resources/metadata/...
custom/Espo/Modules/
‚îú‚îÄ‚îÄ WhatsApp/                     ‚Üê –º–æ–¥—É–ª—å WhatsApp (—Å—É—â–µ—Å—Ç–≤—É–µ—Ç)
‚îÇ   ‚îî‚îÄ‚îÄ Services/WebSocketService.php
‚îî‚îÄ‚îÄ Sales/                        ‚Üê –°–û–ó–î–ê–¢–¨ –ù–û–í–´–ô –ú–û–î–£–õ–¨
```

#### 0.3 –°–æ–∑–¥–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π Sales
```bash
mkdir -p custom/Espo/Modules/Sales/Resources/metadata/entityDefs
mkdir -p custom/Espo/Modules/Sales/Resources/metadata/scopes
mkdir -p custom/Espo/Modules/Sales/Resources/metadata/clientDefs
mkdir -p custom/Espo/Modules/Sales/Resources/i18n/it_IT
mkdir -p custom/Espo/Modules/Sales/Resources/i18n/en_US
mkdir -p custom/Espo/Modules/Sales/Resources/layouts
mkdir -p custom/Espo/Modules/Sales/Entities
mkdir -p custom/Espo/Modules/Sales/Hooks/Quote
mkdir -p custom/Espo/Modules/Sales/Hooks/Opportunity
mkdir -p custom/Espo/Modules/Sales/Controllers
mkdir -p custom/Espo/Modules/Sales/Services
```

#### 0.4 –°–æ–∑–¥–∞—Ç—å Module.php
```php
<?php
// custom/Espo/Modules/Sales/Module.php
namespace Espo\Modules\Sales;

class Module
{
    public function getOrder(): int
    {
        return 11;
    }
}
```

#### 0.5 –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –º–æ–¥—É–ª—å
–ü—Ä–æ–≤–µ—Ä–∏—Ç—å/—Å–æ–∑–¥–∞—Ç—å `custom/modules.json`:
```json
["Sales"]
```
–ï—Å–ª–∏ —Ñ–∞–π–ª —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç —Å `["WhatsApp"]` ‚Äî –¥–æ–±–∞–≤–∏—Ç—å `Sales`:
```json
["WhatsApp", "Sales"]
```

#### 0.6 –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é
```bash
ddev exec php clear_cache.php && ddev exec php rebuild.php
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –Ω–∞ –æ—à–∏–±–∫–∏ autoload
```

---

### –§–ê–ó–ê 1 ‚Äî –°—É—â–Ω–æ—Å—Ç—å Product

#### 1.1 entityDefs
–§–∞–π–ª: `custom/Espo/Modules/Sales/Resources/metadata/entityDefs/Product.json`
```json
{
  "fields": {
    "name": { "type": "varchar", "required": true, "trim": true, "maxLength": 249 },
    "status": {
      "type": "enum",
      "options": ["Active", "Inactive"],
      "default": "Active",
      "required": true,
      "style": { "Active": "success", "Inactive": "danger" }
    },
    "type": {
      "type": "enum",
      "options": ["Product", "Service"],
      "default": "Product",
      "required": true
    },
    "price": { "type": "currency", "required": true, "default": 0 },
    "sku": { "type": "varchar", "maxLength": 100 },
    "description": { "type": "text" },
    "stockQuantity": { "type": "float", "min": 0, "default": 0 },
    "infiniteStock": { "type": "bool", "default": false },
    "minPrice": { "type": "currency" },
    "vatRate": {
      "type": "enum",
      "options": ["22", "10", "4", "17", "0"],
      "default": "22"
    },
    "referenceCountry": {
      "type": "enum",
      "options": ["Italia", "SanMarino", "Estero"],
      "default": "Italia"
    },
    "category": {
      "type": "enum",
      "options": ["Hardware", "Software", "Servizi", "Manutenzione", "Licenze", ""]
    },
    "unitOfMeasure": {
      "type": "enum",
      "options": ["pz", "ora", "kg", "mese", "anno", "licenza", ""]
    },
    "image": { "type": "image" },
    "internalNotes": { "type": "text" }
  },
  "collection": { "sortBy": "name", "asc": true }
}
```

#### 1.2 scopes
–§–∞–π–ª: `custom/Espo/Modules/Sales/Resources/metadata/scopes/Product.json`
```json
{
  "entity": true, "object": true, "layouts": true,
  "tab": true, "acl": true, "module": "Sales",
  "stream": false, "importable": true, "exportable": true,
  "customizable": true, "type": "Base"
}
```

#### 1.3 –ü–µ—Ä–µ–≤–æ–¥—ã it_IT
–§–∞–π–ª: `custom/Espo/Modules/Sales/Resources/i18n/it_IT/Product.json`
```json
{
  "labels": {
    "Create Product": "Crea Prodotto",
    "Product": "Prodotto",
    "Products": "Prodotti"
  },
  "fields": {
    "name": "Nome", "status": "Stato", "type": "Tipo",
    "price": "Prezzo", "sku": "Codice SKU",
    "description": "Descrizione",
    "stockQuantity": "Quantit√† in magazzino",
    "infiniteStock": "Scorta infinita",
    "minPrice": "Prezzo minimo (floor)",
    "vatRate": "Aliquota IVA",
    "referenceCountry": "Paese di riferimento",
    "category": "Categoria",
    "unitOfMeasure": "Unit√† di misura",
    "image": "Immagine",
    "internalNotes": "Note interne"
  },
  "options": {
    "status": { "Active": "Attivo", "Inactive": "Inattivo" },
    "type": { "Product": "Prodotto", "Service": "Servizio" },
    "vatRate": { "22": "22% (Italia)", "10": "10%", "4": "4%", "17": "17% (San Marino)", "0": "0% (Esente)" },
    "referenceCountry": { "Italia": "Italia", "SanMarino": "San Marino", "Estero": "Estero" },
    "category": { "Hardware": "Hardware", "Software": "Software", "Servizi": "Servizi", "Manutenzione": "Manutenzione", "Licenze": "Licenze" },
    "unitOfMeasure": { "pz": "pz", "ora": "ora", "kg": "kg", "mese": "mese", "anno": "anno", "licenza": "licenza" }
  }
}
```

#### 1.4 –ü—Ä–æ–≤–µ—Ä–∫–∞
```bash
ddev exec php clear_cache.php && ddev exec php rebuild.php
# –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: ¬´Prodotti¬ª –ø–æ—è–≤–ª—è–µ—Ç—Å—è –≤ –º–µ–Ω—é –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–∞–±–ª–∏—Ü—É: ddev mysql -e "DESCRIBE product;"
```

---

### –§–ê–ó–ê 2 ‚Äî –°—É—â–Ω–æ—Å—Ç—å Quote (Proposta commerciale)

#### 2.1 entityDefs
–§–∞–π–ª: `custom/Espo/Modules/Sales/Resources/metadata/entityDefs/Quote.json`
```json
{
  "fields": {
    "name": { "type": "varchar", "required": true, "maxLength": 249 },
    "number": { "type": "varchar", "maxLength": 50, "readOnly": true, "index": true },
    "status": {
      "type": "enum",
      "options": ["Draft", "Sent", "Accepted", "Rejected"],
      "default": "Draft",
      "required": true,
      "style": { "Draft": "default", "Sent": "primary", "Accepted": "success", "Rejected": "danger" }
    },
    "validUntil": { "type": "date" },
    "globalDiscount": { "type": "float", "min": 0, "max": 100, "default": 0 },
    "taxableAmount": { "type": "currency", "default": 0, "readOnly": true },
    "totalVat": { "type": "currency", "default": 0, "readOnly": true },
    "totalAmount": { "type": "currency", "default": 0, "readOnly": true },
    "language": { "type": "enum", "options": ["Italiano", "English"], "default": "Italiano" },
    "notesForClient": { "type": "text" },
    "internalNotes": { "type": "text" }
  },
  "links": {
    "opportunity": { "type": "belongsTo", "entity": "Opportunity", "foreign": "quotes", "required": true },
    "account": { "type": "belongsTo", "entity": "Account" },
    "contact": { "type": "belongsTo", "entity": "Contact" },
    "productLists": { "type": "hasMany", "entity": "ProductList", "foreign": "quote" }
  },
  "collection": { "sortBy": "createdAt", "asc": false }
}
```

#### 2.2 scopes
–§–∞–π–ª: `custom/Espo/Modules/Sales/Resources/metadata/scopes/Quote.json`
```json
{
  "entity": true, "object": true, "layouts": true,
  "tab": true, "acl": true, "module": "Sales",
  "stream": true, "importable": false, "exportable": true,
  "customizable": true, "type": "Base"
}
```

#### 2.3 –°–≤—è–∑—å —Å Opportunity (–¥–æ–±–∞–≤–∏—Ç—å –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π —Ñ–∞–π–ª)
–§–∞–π–ª: `custom/Espo/Modules/Sales/Resources/metadata/entityDefs/Opportunity.json`
```json
{
  "links": {
    "quotes": { "type": "hasMany", "entity": "Quote", "foreign": "opportunity" }
  }
}
```

#### 2.4 Hook ‚Äî –∞–≤—Ç–æ-–Ω—É–º–µ—Ä–∞—Ü–∏—è
–§–∞–π–ª: `custom/Espo/Modules/Sales/Hooks/Quote/GenerateNumber.php`
```php
<?php
namespace Espo\Modules\Sales\Hooks\Quote;

use Espo\ORM\Entity;
use Espo\Core\Hook\Hook\BeforeSave;
use Espo\Core\ORM\EntityManager;

class GenerateNumber implements BeforeSave
{
    public function __construct(private EntityManager $entityManager) {}

    public function process(Entity $entity, array $options): void
    {
        if (!$entity->isNew() || $entity->get('number')) return;
        $year = date('Y');
        $last = $this->entityManager->getRepository('Quote')
            ->where(['number*' => 'PROP-' . $year . '-%'])
            ->order('createdAt', 'DESC')->findOne();
        $seq = $last ? ((int) substr($last->get('number'), -5)) + 1 : 1;
        $entity->set('number', sprintf('PROP-%s-%05d', $year, $seq));
    }
}
```

#### 2.5 Hook ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ –ø–µ—Ä–≤–æ–π ProductList
–§–∞–π–ª: `custom/Espo/Modules/Sales/Hooks/Quote/CreateDefaultProductList.php`
```php
<?php
namespace Espo\Modules\Sales\Hooks\Quote;

use Espo\ORM\Entity;
use Espo\Core\Hook\Hook\AfterSave;
use Espo\Core\ORM\EntityManager;

class CreateDefaultProductList implements AfterSave
{
    public function __construct(private EntityManager $entityManager) {}

    public function process(Entity $entity, array $options): void
    {
        if (!$entity->isNew()) return;
        $list = $this->entityManager->getNewEntity('ProductList');
        $list->set([
            'name' => 'Gruppo 1',
            'order' => 1,
            'quoteId' => $entity->getId()
        ]);
        $this->entityManager->saveEntity($list);
    }
}
```

#### 2.6 Hook ‚Äî –≤–∞–ª–∏–¥–∞—Ü–∏—è —Å—É–º–º—ã
–§–∞–π–ª: `custom/Espo/Modules/Sales/Hooks/Quote/ValidateAmount.php`
```php
<?php
namespace Espo\Modules\Sales\Hooks\Quote;

use Espo\ORM\Entity;
use Espo\Core\Hook\Hook\BeforeSave;
use Espo\Core\ORM\EntityManager;
use Espo\Core\Exceptions\Error;

class ValidateAmount implements BeforeSave
{
    public function __construct(private EntityManager $entityManager) {}

    public function process(Entity $entity, array $options): void
    {
        $opportunityId = $entity->get('opportunityId');
        if (!$opportunityId) return;
        $opp = $this->entityManager->getRepository('Opportunity')->getById($opportunityId);
        if (!$opp) return;
        $oppAmount = (float) $opp->get('amount');
        $quoteTotal = (float) $entity->get('totalAmount');
        if ($oppAmount > 0 && $quoteTotal > $oppAmount) {
            // Soft warning via metadata ‚Äî non blocca il salvataggio
            // Per blocco hard: throw new Error('Quote supera il valore Opportunit√†');
            $entity->set('_amountWarning', true);
        }
    }
}
```

#### 2.7 –ü–µ—Ä–µ–≤–æ–¥—ã it_IT Quote
–§–∞–π–ª: `custom/Espo/Modules/Sales/Resources/i18n/it_IT/Quote.json`
```json
{
  "labels": {
    "Create Quote": "Crea Proposta",
    "Quote": "Proposta commerciale",
    "Quotes": "Proposte commerciali"
  },
  "fields": {
    "name": "Nome proposta", "number": "Numero proposta",
    "status": "Stato", "validUntil": "Valida fino al",
    "globalDiscount": "Sconto globale (%)",
    "taxableAmount": "Imponibile", "totalVat": "IVA totale",
    "totalAmount": "Totale con IVA", "language": "Lingua proposta",
    "notesForClient": "Note per il cliente", "internalNotes": "Note interne",
    "opportunity": "Opportunit√†", "account": "Cliente",
    "contact": "Contatto", "productLists": "Liste prodotti"
  },
  "options": {
    "status": { "Draft": "Bozza", "Sent": "Inviata", "Accepted": "Accettata", "Rejected": "Rifiutata" },
    "language": { "Italiano": "Italiano", "English": "English" }
  }
}
```

---

### –§–ê–ó–ê 3 ‚Äî ProductList + ProductListItem

#### 3.1 entityDefs ProductList
–§–∞–π–ª: `custom/Espo/Modules/Sales/Resources/metadata/entityDefs/ProductList.json`
```json
{
  "fields": {
    "name": { "type": "varchar", "required": true, "default": "Gruppo 1", "maxLength": 100 },
    "order": { "type": "int", "default": 1 },
    "subtotal": { "type": "currency", "default": 0, "readOnly": true },
    "groupDescription": { "type": "text" }
  },
  "links": {
    "quote": { "type": "belongsTo", "entity": "Quote", "foreign": "productLists", "required": true },
    "items": { "type": "hasMany", "entity": "ProductListItem", "foreign": "productList" }
  },
  "collection": { "sortBy": "order", "asc": true }
}
```

#### 3.2 scopes ProductList ‚Äî –ó–ê–ü–†–ï–©–ï–ù–û –≤ –º–µ–Ω—é!
–§–∞–π–ª: `custom/Espo/Modules/Sales/Resources/metadata/scopes/ProductList.json`
```json
{
  "entity": true,
  "object": false,
  "layouts": false,
  "tab": false,
  "acl": "Quote",
  "module": "Sales",
  "type": "Base"
}
```
> ‚ö†Ô∏è `"tab": false` + `"object": false` ‚Äî –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ ProductList –Ω–µ –ø–æ—è–≤–∏—Ç—Å—è –≤ –º–µ–Ω—é –Ω–∞–≤–∏–≥–∞—Ü–∏–∏

#### 3.3 entityDefs ProductListItem
–§–∞–π–ª: `custom/Espo/Modules/Sales/Resources/metadata/entityDefs/ProductListItem.json`
```json
{
  "fields": {
    "quantity": { "type": "float", "min": 0.001, "default": 1, "required": true },
    "unitPrice": { "type": "currency", "required": true },
    "discount": { "type": "float", "min": 0, "max": 100, "default": 0 },
    "totalWithoutDiscount": { "type": "currency", "readOnly": true },
    "lineTotal": { "type": "currency", "readOnly": true },
    "vatRate": { "type": "float", "default": 22 },
    "lineDescription": { "type": "text" }
  },
  "links": {
    "productList": { "type": "belongsTo", "entity": "ProductList", "foreign": "items", "required": true },
    "product": { "type": "belongsTo", "entity": "Product", "required": true }
  }
}
```

#### 3.4 scopes ProductListItem ‚Äî —Ç–æ–∂–µ —Å–∫—Ä—ã—Ç
–§–∞–π–ª: `custom/Espo/Modules/Sales/Resources/metadata/scopes/ProductListItem.json`
```json
{ "entity": true, "object": false, "tab": false, "module": "Sales", "type": "Base" }
```

---

### –§–ê–ó–ê 4 ‚Äî –°—É—â–Ω–æ—Å—Ç—å Contract

#### 4.1 entityDefs
–§–∞–π–ª: `custom/Espo/Modules/Sales/Resources/metadata/entityDefs/Contract.json`
```json
{
  "fields": {
    "name": { "type": "varchar", "required": true, "maxLength": 249 },
    "number": { "type": "varchar", "maxLength": 50, "readOnly": true, "index": true },
    "status": {
      "type": "enum",
      "options": ["Active", "Expired", "Cancelled", "Renewed"],
      "default": "Active",
      "required": true,
      "style": { "Active": "success", "Expired": "danger", "Cancelled": "default", "Renewed": "primary" }
    },
    "signed": { "type": "bool", "default": false },
    "renewed": { "type": "bool", "default": false },
    "autoRenewal": { "type": "bool", "default": false },
    "renewalNoticeDays": { "type": "int", "default": 30 },
    "value": { "type": "currency", "required": true },
    "signDate": { "type": "date" },
    "startDate": { "type": "date" },
    "expirationDate": { "type": "date" },
    "cancellationDate": { "type": "date" },
    "durationMonths": { "type": "int", "readOnly": true },
    "terms": { "type": "text" },
    "internalNotes": { "type": "text" }
  },
  "links": {
    "opportunity": { "type": "belongsTo", "entity": "Opportunity", "foreign": "contract", "required": true },
    "account": { "type": "belongsTo", "entity": "Account", "required": true },
    "contact": { "type": "belongsTo", "entity": "Contact" },
    "winningQuote": { "type": "belongsTo", "entity": "Quote" }
  },
  "collection": { "sortBy": "createdAt", "asc": false }
}
```

#### 4.2 scopes
–§–∞–π–ª: `custom/Espo/Modules/Sales/Resources/metadata/scopes/Contract.json`
```json
{
  "entity": true, "object": true, "layouts": true,
  "tab": true, "acl": true, "module": "Sales",
  "stream": true, "importable": false, "exportable": true,
  "customizable": true, "type": "Base"
}
```

#### 4.3 Hook ‚Äî –∞–≤—Ç–æ-—Å–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞ –ø—Ä–∏ Closed Won
–§–∞–π–ª: `custom/Espo/Modules/Sales/Hooks/Opportunity/CreateContract.php`
```php
<?php
namespace Espo\Modules\Sales\Hooks\Opportunity;

use Espo\ORM\Entity;
use Espo\Core\Hook\Hook\AfterSave;
use Espo\Core\ORM\EntityManager;

class CreateContract implements AfterSave
{
    public function __construct(private EntityManager $entityManager) {}

    public function process(Entity $entity, array $options): void
    {
        $stage = $entity->get('stage');
        $prevStage = $entity->getFetched('stage');

        // –¢–æ–ª—å–∫–æ –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ -> Closed Won
        if ($stage !== 'Closed Won' || $prevStage === 'Closed Won') return;

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º: –Ω–µ—Ç –ª–∏ —É–∂–µ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞
        $existing = $this->entityManager->getRepository('Contract')
            ->where(['opportunityId' => $entity->getId()])->findOne();
        if ($existing) return;

        // –ò—â–µ–º –ø—Ä–∏–Ω—è—Ç—É—é Quote
        $acceptedQuote = $this->entityManager->getRepository('Quote')
            ->where(['opportunityId' => $entity->getId(), 'status' => 'Accepted'])
            ->findOne();

        // –ê–≤—Ç–æ-–Ω—É–º–µ—Ä–∞—Ü–∏—è
        $year = date('Y');
        $last = $this->entityManager->getRepository('Contract')
            ->where(['number*' => 'CON-' . $year . '-%'])
            ->order('createdAt', 'DESC')->findOne();
        $seq = $last ? ((int) substr($last->get('number'), -5)) + 1 : 1;
        $number = sprintf('CON-%s-%05d', $year, $seq);

        // –°–æ–∑–¥–∞—ë–º –∫–æ–Ω—Ç—Ä–∞–∫—Ç
        $contract = $this->entityManager->getNewEntity('Contract');
        $contract->set([
            'name'          => 'Contratto - ' . $entity->get('name'),
            'number'        => $number,
            'status'        => 'Active',
            'value'         => $entity->get('amount'),
            'opportunityId' => $entity->getId(),
            'accountId'     => $entity->get('accountId'),
            'winningQuoteId'=> $acceptedQuote ? $acceptedQuote->getId() : null,
        ]);
        $this->entityManager->saveEntity($contract);
    }
}
```

#### 4.4 –ü–µ—Ä–µ–≤–æ–¥—ã it_IT Contract
–§–∞–π–ª: `custom/Espo/Modules/Sales/Resources/i18n/it_IT/Contract.json`
```json
{
  "labels": {
    "Create Contract": "Crea Contratto",
    "Contract": "Contratto",
    "Contracts": "Contratti"
  },
  "fields": {
    "name": "Nome contratto", "number": "Numero contratto",
    "status": "Stato", "signed": "Firmato", "renewed": "Rinnovato",
    "autoRenewal": "Rinnovo automatico",
    "renewalNoticeDays": "Giorni preavviso rinnovo",
    "value": "Valore (EUR)", "signDate": "Data firma",
    "startDate": "Data inizio", "expirationDate": "Data scadenza",
    "cancellationDate": "Data disdetta", "durationMonths": "Durata (mesi)",
    "terms": "Termini e condizioni", "internalNotes": "Note interne",
    "opportunity": "Opportunit√†", "account": "Cliente",
    "contact": "Contatto firmatario", "winningQuote": "Proposta accettata"
  },
  "options": {
    "status": { "Active": "Attivo", "Expired": "Scaduto", "Cancelled": "Disdetto", "Renewed": "Rinnovato" }
  }
}
```

---

### –§–ê–ó–ê 5 ‚Äî PDF Templates

#### 5.1 PDF –¥–ª—è Quote
- EspoCRM –Ω–∞—Ç–∏–≤–Ω–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç PDF Templates (`Admin > PDF Templates`)
- –°–∏–Ω—Ç–∞–∫—Å–∏—Å —à–∞–±–ª–æ–Ω–æ–≤: Handlebars-–ø–æ–¥–æ–±–Ω—ã–π
- –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ª–æ–≥–æ—Ç–∏–ø: `Admin > Company Settings > Logo`

**–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ Quote –¥–ª—è PDF**:
```
{{name}} ‚Äî –Ω–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è
{{number}} ‚Äî PROP-2026-00001
{{account.name}} ‚Äî –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞
{{contact.name}} ‚Äî –∏–º—è –∫–æ–Ω—Ç–∞–∫—Ç–∞
{{validUntil}} ‚Äî —Å—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è
{{taxableAmount}} ‚Äî imponibile
{{totalVat}} ‚Äî IVA totale
{{totalAmount}} ‚Äî totale con IVA
{{notesForClient}} ‚Äî note per cliente
```

**–¢–∞–±–ª–∏—Ü–∞ –ø—Ä–æ–¥—É–∫—Ç–æ–≤ (foreach)**:
```handlebars
{{#each productLists}}
<h3>{{name}}</h3>
<table border="1">
  <tr><th>Prodotto</th><th>Qt√†</th><th>U.M.</th><th>Prezzo</th><th>Sconto</th><th>Totale</th></tr>
  {{#each items}}
  <tr>
    <td>{{product.name}}</td>
    <td>{{quantity}}</td>
    <td>{{product.unitOfMeasure}}</td>
    <td>{{unitPrice}}</td>
    <td>{{discount}}%</td>
    <td>{{lineTotal}}</td>
  </tr>
  {{/each}}
</table>
<p>Subtotale gruppo: <strong>{{subtotal}}</strong></p>
{{/each}}
```

> ‚ö†Ô∏è –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É `each` –≤ –≤–µ—Ä—Å–∏–∏ EspoCRM 9.3.0. –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–∞—Å—Ç–æ–º–Ω—ã–π PDF —Ä–µ–Ω–¥–µ—Ä–µ—Ä (Twig / Mustache).

---

### –§–ê–ó–ê 6 ‚Äî –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

#### –°—Ü–µ–Ω–∞—Ä–∏–π Happy Path:
1. `Admin > Products` ‚Üí —Å–æ–∑–¥–∞—Ç—å 3 –ø—Ä–æ–¥—É–∫—Ç–∞ —Å —Ä–∞–∑–Ω—ã–º–∏ vatRate
2. CRM ‚Üí Account ‚Üí Lead ‚Üí Opportunity
3. –í Opportunity ‚Üí —Å–æ–∑–¥–∞—Ç—å Quote ‚Üí –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∞–≤—Ç–æ-–Ω–æ–º–µ—Ä `PROP-2026-00001`
4. –í Quote ‚Üí –¥–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–¥—É–∫—Ç—ã –≤ `Gruppo 1` ‚Üí –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞—Å—á—ë—Ç subtotal
5. –ù–∞–∂–∞—Ç—å `+` ‚Üí –¥–æ–±–∞–≤–∏—Ç—å `Gruppo 2` —Å –¥—Ä—É–≥–∏–º–∏ –ø—Ä–æ–¥—É–∫—Ç–∞–º–∏
6. –ò–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å Quote ‚Üí `Accepted`
7. –ò–∑–º–µ–Ω–∏—Ç—å Opportunity.stage ‚Üí `Closed Won`
8. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å: Contract —Å–æ–∑–¥–∞–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å –Ω–æ–º–µ—Ä–æ–º `CON-2026-00001`
9. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ Contract: account, opportunity, winningQuote –∑–∞–ø–æ–ª–Ω–µ–Ω—ã
10. –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å PDF Quote ‚Äî –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–∞–±–ª–∏—Ü—É –ø—Ä–æ–¥—É–∫—Ç–æ–≤

#### Edge Cases:
- Opportunity ‚Üí Closed Won –¥–≤–∞–∂–¥—ã ‚Üí Contract —Å–æ–∑–¥–∞—ë—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑ ‚úÖ
- Quote.totalAmount > Opportunity.amount ‚Üí –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ ‚úÖ
- –ü–æ–ø—ã—Ç–∫–∞ —Å–æ–∑–¥–∞—Ç—å ProductList –∏–∑ URL –Ω–∞–ø—Ä—è–º—É—é ‚Üí –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –æ—à–∏–±–∫–∞ ‚úÖ
- Product —Å `minPrice = 100` ‚Üí —Å–∫–∏–¥–∫–∞ –¥–æ unitPrice < 100 ‚Üí –≤–∞–ª–∏–¥–∞—Ü–∏—è –±–ª–æ–∫–∏—Ä—É–µ—Ç ‚úÖ

---

### –§–ê–ó–ê 7 ‚Äî Deploy

```bash
# 1. –í—Å–µ —Ñ–∞–π–ª—ã –∑–∞–∫–æ–º–º–∏—á–µ–Ω—ã
git add custom/Espo/Modules/Sales/
git commit -m "feat(sales): add Sales module - Product, Quote, ProductList, Contract"
git push

# 2. –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ
php clear_cache.php && php rebuild.php

# 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
tail -f data/logs/espo.log
```

---

## ‚öôÔ∏è –ü–†–ê–í–ò–õ–ê –†–ê–ë–û–¢–´ –° ESPOCRM (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –ß–ò–¢–ê–¢–¨)

1. **–ù–ò–ö–û–ì–î–ê** –Ω–µ —Ç—Ä–æ–≥–∞—Ç—å `application/` ‚Äî —ç—Ç–æ —è–¥—Ä–æ —Å–∏—Å—Ç–µ–º—ã
2. **–í–°–ï–ì–î–ê** –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `custom/` –¥–ª—è –∫–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏–π
3. –ü–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è metadata: `php clear_cache.php && php rebuild.php`
4. –ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è JS: –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å `?v=` –≤ `client.json`
5. Hooks = business logic. Controllers = —Ç–æ–ª—å–∫–æ API endpoints (–µ—Å–ª–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ)
6. Namespace –º–æ–¥—É–ª—è Sales: `Espo\Modules\Sales\...`
7. Namespace WhatsApp (—É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç): `Espo\Modules\WhatsApp\...`
8. Namespace —Å—Ç–∞—Ä—ã–π Custom (WhatsApp Controller): `Espo\Custom\...`

---

## üìÅ –ü–û–õ–ù–ê–Ø –°–¢–†–£–ö–¢–£–†–ê –†–ï–ü–û–ó–ò–¢–û–†–ò–Ø

```
gomercatocrm/                        ‚Üê root EspoCRM 9.3.0
‚îú‚îÄ‚îÄ application/                     ‚Üê ‚õî –Ø–î–†–û, –ù–ï –¢–†–û–ì–ê–¢–¨
‚îú‚îÄ‚îÄ client/
‚îÇ   ‚îî‚îÄ‚îÄ custom/
‚îÇ       ‚îú‚îÄ‚îÄ src/
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ whatsapp-widget-init.js    ‚Üê WhatsApp Frontend Widget
‚îÇ       ‚îî‚îÄ‚îÄ css/
‚îÇ           ‚îî‚îÄ‚îÄ whatsapp-widget.css
‚îú‚îÄ‚îÄ custom/
‚îÇ   ‚îî‚îÄ‚îÄ Espo/
‚îÇ       ‚îú‚îÄ‚îÄ Custom/                  ‚Üê —Å—Ç–∞—Ä—ã–π namespace (WhatsApp Controller)
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ Controllers/
‚îÇ       ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ WhatsApp.php
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ Core/WhatsApp/
‚îÇ       ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ WhatsAppClient.php
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ Resources/
‚îÇ       ‚îÇ       ‚îî‚îÄ‚îÄ metadata/
‚îÇ       ‚îÇ           ‚îú‚îÄ‚îÄ entityDefs/WhatsAppMessage.json
‚îÇ       ‚îÇ           ‚îú‚îÄ‚îÄ app/client.json
‚îÇ       ‚îÇ           ‚îú‚îÄ‚îÄ app/webSocket.json
‚îÇ       ‚îÇ           ‚îî‚îÄ‚îÄ routes.json
‚îÇ       ‚îî‚îÄ‚îÄ Modules/
‚îÇ           ‚îú‚îÄ‚îÄ WhatsApp/            ‚Üê –º–æ–¥—É–ª—å WhatsApp
‚îÇ           ‚îÇ   ‚îî‚îÄ‚îÄ Services/WebSocketService.php
‚îÇ           ‚îî‚îÄ‚îÄ Sales/               ‚Üê ‚úÖ –ù–û–í–´–ô –ú–û–î–£–õ–¨ (—Å–æ–∑–¥–∞—Ç—å)
‚îÇ               ‚îú‚îÄ‚îÄ Module.php
‚îÇ               ‚îú‚îÄ‚îÄ Entities/
‚îÇ               ‚îú‚îÄ‚îÄ Hooks/
‚îÇ               ‚îú‚îÄ‚îÄ Controllers/
‚îÇ               ‚îú‚îÄ‚îÄ Services/
‚îÇ               ‚îî‚îÄ‚îÄ Resources/
‚îú‚îÄ‚îÄ impls/
‚îÇ   ‚îú‚îÄ‚îÄ whatsapp_architecture.md     ‚Üê –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è WhatsApp
‚îÇ   ‚îî‚îÄ‚îÄ sales_modules_architecture.md ‚Üê —ç—Ç–æ—Ç —Ñ–∞–π–ª
‚îú‚îÄ‚îÄ .ddev/
‚îÇ   ‚îî‚îÄ‚îÄ nginx/websocket.conf         ‚Üê WSS proxy
‚îî‚îÄ‚îÄ README.md
```

---

## üîó –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- **EspoCRM Docs**: [docs.espocrm.com](https://docs.espocrm.com)
- **EspoCRM Forum**: [forum.espocrm.com](https://forum.espocrm.com)
- **GitHub repo**: [github.com/skdvlpr/gomercatocrm](https://github.com/skdvlpr/gomercatocrm)
- **Notion (–ø–ª–∞–Ω)**: [Sales modules creation](https://www.notion.so/3118d469d40580ab9a02ec2afb75c0f5)
- **EspoCRM PDF Templates**: [docs.espocrm.com/user-guide/pdf-templates](https://docs.espocrm.com/user-guide/pdf-templates/)
- **EspoCRM Hooks**: [docs.espocrm.com/development/hooks](https://docs.espocrm.com/development/hooks/)
- **EspoCRM Metadata**: [docs.espocrm.com/development/metadata](https://docs.espocrm.com/development/metadata/)
